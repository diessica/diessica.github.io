<!doctype html><html class="scroll-smooth md:border-[10px] md:border-solid min-h-screen md:border-purple" lang=en><head><meta charset=utf-8><link href="/css/style.css?h=012c5f95ea1463230821" rel=stylesheet><meta content="width=device-width,initial-scale=1" name=viewport><title>var that = this? Nah. | Diéssica Gurskas</title><body class="text-gray-700 font-body antialiased"><div class="bg-blog px-3 md:px-10 min-h-[calc(100vh-16px)] lg:min-h-[calc(100vh-20px)]"><div class="py-12 mb-4 text-center space-x-8 text-md md:text-lg relative z-20"><a class="no-underline font-extrabold hover:border-green hover:border-b-2" href=/>diessi.ca</a><a class="no-underline hover:border-green hover:border-b-2 border-green border-b-2" href=/blog/>Blog</a><a class="no-underline hover:border-green hover:border-b-2" href=/misc/>Misc</a></div><article class="container mx-auto w-full xl:w-1/2 pb-8"><header class="xl:-mx-56 text-center mb-8 md:mb-12"><div class="uppercase tracking-widest opacity-60 mb-4 text-xs">March 15, 2017</div><h1 class="font-extrabold font-display text-3xl md:text-5xl xl:text-6xl text-slate-900">var that = this? Nah.</h1></header><div class="prose prose-sm md:prose 2xl:prose-lg prose-hr:text-red prose-hr:w-48 prose-hr:h-0.5 prose-hr:mx-auto prose-hr:my-4 prose-hr:bg-black prose-hr:opacity-20 prose-hr:border-0 prose-hr:rounded prose-hr:md:my-10 prose-pre:rounded-none prose-blockquote:border-0 prose-blockquote:text-center prose-blockquote:text-xl prose-blockquote:text-current tracking-tight mx-auto prose-headings:text-slate-800 prose-headings:w-max prose-headings:font-display prose-headings:font-extrabold"><p>Tried JavaScript for some minutes? You probably already wrote the following.<pre class=language-js data-lang=js style=color:#f8f8f2;background-color:#282a36><code class=language-js data-lang=js><span style=color:#8be9fd;font-style:italic>var </span><span style=color:#fff>that </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>this</span><span>;
</span></code></pre><p>(Or one of its variants, such as <code>var self = this</code>.)<p>That’s a pretty common pattern when you found yourself in a situation where:<ol><li>you have a function nested inside of an object’s method, and<li>you want to access the object’s properties, but<li>JavaScript’s <code>this</code> is bound in an unexpected way.</ol><hr><p>Workarounding unexpected callback scope is one of the main situations where developers write <code>var self = this</code>.<p>Let’s assume a piece of code with a callback function.<pre class=language-js data-lang=js style=color:#f8f8f2;background-color:#282a36><code class=language-js data-lang=js><span style=color:#8be9fd;font-style:italic>function </span><span style=color:#50fa7b>Requester</span><span>(</span><span style=color:#ffb86c;font-style:italic>data</span><span>, </span><span style=color:#ffb86c;font-style:italic>req</span><span>) {
</span><span>  </span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data </span><span style=color:#ff79c6>= </span><span style=color:#fff>data</span><span>;
</span><span>
</span><span>  </span><span style=color:#fff>req</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>done</span><span>(</span><span style=color:#8be9fd;font-style:italic>function </span><span>() {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>log</span><span>(</span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data); </span><span style=color:#6272a4>// undefined
</span><span>  });
</span><span>}
</span></code></pre><p>You’d expect <code>this.data</code> to be the <code>data</code> argument. Yet, JavaScript tells you that it is actually <code>undefined</code>.<p>So, because Stack Overflow says so, you do the following:<pre class=language-js data-lang=js style=color:#f8f8f2;background-color:#282a36><code class=language-js data-lang=js><span style=color:#8be9fd;font-style:italic>function </span><span style=color:#50fa7b>Requester</span><span>(</span><span style=color:#ffb86c;font-style:italic>data</span><span>, </span><span style=color:#ffb86c;font-style:italic>req</span><span>) {
</span><span>  </span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data </span><span style=color:#ff79c6>= </span><span style=color:#fff>data</span><span>;
</span><span>  </span><span style=color:#8be9fd;font-style:italic>var </span><span style=color:#fff>self </span><span style=color:#ff79c6>= </span><span style=color:#bd93f9>this</span><span>; </span><span style=color:#6272a4>// NOOOOOoOooo
</span><span>
</span><span>  </span><span style=color:#fff>req</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>done</span><span>(</span><span style=color:#8be9fd;font-style:italic>function </span><span>() {
</span><span>    </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>log</span><span>(</span><span style=color:#fff>self</span><span style=color:#ff79c6>.</span><span>data);
</span><span>  });
</span><span>}
</span></code></pre><p>And never stops doing it in your life.<p>Still do it? I’m flattered to tell you that <strong>you don’t need that extra variable anymore</strong>.<h2 id=arrow-functions>Arrow functions</h2><p>Go with <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions>arrow functions</a> instead. Besides having a shorter syntax, arrow functions bind to the parent scope by default.<p>The scope that was firstly intuitive to you will work as expected now.<pre class=language-js data-lang=js style=color:#f8f8f2;background-color:#282a36><code class=language-js data-lang=js><span style=color:#8be9fd;font-style:italic>function </span><span style=color:#50fa7b>Requester</span><span>(</span><span style=color:#ffb86c;font-style:italic>data</span><span>, </span><span style=color:#ffb86c;font-style:italic>req</span><span>) {
</span><span>  </span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data </span><span style=color:#ff79c6>= </span><span style=color:#fff>data</span><span>;
</span><span>
</span><span>  </span><span style=color:#fff>req</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>done</span><span>(() </span><span style=color:#8be9fd;font-style:italic>=> </span><span>{
</span><span>    </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>log</span><span>(</span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data); </span><span style=color:#6272a4>// intuitive as hell!
</span><span>  });
</span><span>}
</span></code></pre><p class=note>You can count on them most of the time, but they also have unexpected behaviour in more advanced cases. After all, you're dealing with the `this` keyword. So don't just go around refactoring all anonymous functions into arrow ones and expecting everything to work.<h2 id=you-may-also-bind>You may also <code>.bind()</code>!</h2><p>If for some reason (such as <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#Browser_compatibility>no support for IE</a>) you can’t use them, check JavaScript’s <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind><code>bind</code></a>. It’s not as awesome as arrow functions, but does the job.<pre class=language-js data-lang=js style=color:#f8f8f2;background-color:#282a36><code class=language-js data-lang=js><span style=color:#8be9fd;font-style:italic>function </span><span style=color:#50fa7b>Requester</span><span>(</span><span style=color:#ffb86c;font-style:italic>data</span><span>, </span><span style=color:#ffb86c;font-style:italic>req</span><span>) {
</span><span>  </span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data </span><span style=color:#ff79c6>= </span><span style=color:#fff>data</span><span>;
</span><span>
</span><span>  </span><span style=color:#fff>req</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>done</span><span>(
</span><span>    </span><span style=color:#8be9fd;font-style:italic>function </span><span>() {
</span><span>      </span><span style=color:#66d9ef;font-style:italic>console</span><span style=color:#ff79c6>.</span><span style=color:#8be9fd>log</span><span>(</span><span style=color:#bd93f9>this</span><span style=color:#ff79c6>.</span><span>data);
</span><span>    }</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>bind</span><span>(</span><span style=color:#bd93f9>this</span><span>)
</span><span>  );
</span><span>}
</span></code></pre></div></article></div></body><script src=/footnotes.js></script>